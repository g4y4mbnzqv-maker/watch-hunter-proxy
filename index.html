<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vintage Watch Deal Hunter</title>
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
* { box-sizing:border-box; margin:0; padding:0; }
body { background:linear-gradient(150deg,#f5f0e6 0%,#ede8db 100%); min-height:100vh; font-family:'DM Mono',monospace; padding:32px 16px; }
.container { max-width:580px; margin:0 auto; }
@keyframes fadeUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
@keyframes shimIn { from{opacity:0;transform:translateY(4px)} to{opacity:1;transform:translateY(0)} }

h1 { font-family:â€˜Loraâ€™,serif; font-size:32px; font-weight:700; color:#1c1410; line-height:1.08; letter-spacing:-0.5px; }
h1 span { color:#d97706; }

/* Status */
.status-bar { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
.dot { width:7px; height:7px; border-radius:50%; display:inline-block; transition:all 0.3s; background:#ccc; }
.dot.loading { background:#d97706; box-shadow:0 0 0 3px #fef3c7; }
.dot.live    { background:#16a34a; box-shadow:0 0 0 3px #dcfce7; }
.dot.warn    { background:#f59e0b; box-shadow:0 0 0 3px #fef3c7; }
.status-text { font-size:10px; color:#b8a898; letter-spacing:2px; text-transform:uppercase; }
.status-time { font-size:9px; color:#c8bfb0; margin-left:auto; }

/* Banners */
.banner { margin-bottom:12px; padding:8px 14px; border-radius:10px; font-size:10px; }
.banner.live { background:#f0fdf4; border:1px solid #bbf7d0; color:#166534; }
.banner.warn { background:#fffbeb; border:1px solid #fde68a; color:#92400e; }
.banner.nok  { background:#f0fdf4; border:1px solid #bbf7d0; color:#166534; }
.banner.nno  { background:#fef2f2; border:1px solid #fecaca; color:#991b1b; }
.notif-ask { background:#fff; border:1px solid #e8e2d8; border-radius:12px; padding:12px 14px; display:flex; align-items:center; gap:10px; margin-bottom:12px; }
.notif-ask h4 { font-family:â€˜Loraâ€™,serif; font-size:11px; color:#2c2416; font-weight:600; }
.notif-ask p  { font-size:10px; color:#b8a898; margin-top:2px; }
.notif-ask button { padding:6px 14px; background:#d97706; color:#fff; border:none; border-radius:8px; font-size:10px; cursor:pointer; white-space:nowrap; }

/* Search */
.search-wrap  { position:relative; margin-bottom:12px; }
.search-input { width:100%; padding:11px 90px 11px 16px; background:#fff; border:1px solid #ddd5c8; border-radius:12px; font-family:â€˜DM Monoâ€™,monospace; font-size:13px; color:#2c2416; outline:none; transition:all 0.18s; }
.search-input:focus { border-color:#d97706; box-shadow:0 0 0 3px rgba(217,119,6,0.1); }
.search-input::placeholder { color:#c8bfb0; }
.search-go    { position:absolute; right:8px; top:50%; transform:translateY(-50%); background:#d97706; border:none; border-radius:8px; cursor:pointer; color:#fff; font-size:10px; padding:5px 10px; }
.search-clear { position:absolute; right:72px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; color:#c8bfb0; font-size:14px; display:none; }
.search-clear.show { display:block; }

/* Brands */
.section-lbl { font-size:9px; color:#b8a898; letter-spacing:2px; text-transform:uppercase; margin-bottom:6px; }
.brands { display:flex; gap:5px; flex-wrap:wrap; margin-bottom:12px; }
.brand { padding:5px 10px; border-radius:20px; font-size:10px; cursor:pointer; border:1px solid #ddd5c8; background:#fff; color:#b8a898; transition:all 0.18s; white-space:nowrap; }
.brand.on { background:#1c1410; border-color:#1c1410; color:#fff; }
.brand:hover:not(.on) { border-color:#d97706; color:#b45309; }

/* Tabs */
.tabs { display:flex; gap:6px; margin-bottom:12px; }
.tab { flex:1; padding:9px 4px; border-radius:10px; font-size:10px; cursor:pointer; transition:all 0.18s; border:1px solid #ddd5c8; background:transparent; color:#b8a898; }
.tab.on { background:#fff; border:1.5px solid #d97706; color:#b45309; box-shadow:0 2px 10px rgba(217,119,6,0.1); }

/* Controls */
.controls { display:flex; gap:6px; margin-bottom:12px; flex-wrap:wrap; align-items:center; }
.pill { padding:7px 12px; border-radius:20px; cursor:pointer; font-size:10px; transition:all 0.18s; border:1px solid #ddd5c8; background:#fff; color:#b8a898; white-space:nowrap; }
.pill.on { background:#fffbeb; border-color:#f59e0b; color:#b45309; }
.pill.watchlist-on { background:#fef2f2; border-color:#fca5a5; color:#dc2626; }
.sort-sel { padding:7px 26px 7px 10px; background:#fff; border:1px solid #ddd5c8; border-radius:20px; font-size:10px; color:#b8a898; cursor:pointer; outline:none; -webkit-appearance:none; appearance:none; background-image:url(â€œdata:image/svg+xml,%3Csvg xmlns=â€˜http://www.w3.org/2000/svgâ€™ width=â€˜10â€™ height=â€˜6â€™%3E%3Cpath d=â€˜M0 0l5 6 5-6zâ€™ fill=â€™%23c8bfb0â€™/%3E%3C/svg%3Eâ€); background-repeat:no-repeat; background-position:right 8px center; }
.refresh-btn { margin-left:auto; padding:7px 11px; background:#fff; border:1px solid #ddd5c8; border-radius:20px; cursor:pointer; color:#b8a898; font-size:14px; transition:all 0.18s; }
.refresh-btn:hover { color:#d97706; border-color:#d97706; }

/* Condition filter */
.condition-row { display:flex; gap:5px; flex-wrap:wrap; margin-bottom:12px; }
.cond { padding:5px 10px; border-radius:20px; font-size:10px; cursor:pointer; border:1px solid #ddd5c8; background:#fff; color:#b8a898; transition:all 0.18s; white-space:nowrap; }
.cond.on { background:#fffbeb; border-color:#d97706; color:#b45309; }

/* Slider */
.slider-box { margin-bottom:12px; padding:14px 16px; background:#fff; border-radius:12px; border:1px solid #e8e2d8; }
.slider-hd  { display:flex; justify-content:space-between; margin-bottom:10px; }
.slider-lbl { font-size:10px; color:#b8a898; letter-spacing:1px; }
.slider-val { font-family:â€˜Loraâ€™,serif; font-size:14px; font-weight:700; color:#d97706; }
input[type=range] { -webkit-appearance:none; width:100%; height:4px; outline:none; cursor:pointer; border-radius:2px; background:linear-gradient(90deg,#d97706 30%,#e8e2d8 30%); }
input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:18px; height:18px; border-radius:50%; background:#d97706; cursor:pointer; box-shadow:0 1px 6px rgba(217,119,6,0.35); }
.slider-limits { display:flex; justify-content:space-between; margin-top:5px; font-size:9px; color:#c8bfb0; }

/* Countdown */
.cdwn { margin-bottom:14px; }
.cdwn-hd    { display:flex; justify-content:space-between; margin-bottom:5px; }
.cdwn-lbl   { font-size:10px; color:#b8a898; letter-spacing:1px; }
.cdwn-t     { font-size:10px; color:#d97706; }
.cdwn-track { height:3px; background:#ede8de; border-radius:2px; overflow:hidden; }
.cdwn-fill  { height:100%; background:linear-gradient(90deg,#d97706,#fbbf24); border-radius:2px; transition:width 1s linear; }

/* Stats */
.stats { display:flex; margin-bottom:12px; background:#fff; border-radius:12px; border:1px solid #e8e2d8; overflow:hidden; }
.stat { flex:1; padding:12px 8px; text-align:center; border-right:1px solid #f0ebe0; }
.stat:last-child { border-right:none; }
.stat-v { font-family:â€˜Loraâ€™,serif; font-size:19px; font-weight:700; }
.stat-l { font-size:9px; color:#c8bfb0; letter-spacing:1px; margin-top:2px; }

/* Alerts */
.alert-log  { margin-bottom:12px; }
.alert-lbl  { font-size:9px; color:#b8a898; letter-spacing:2px; margin-bottom:6px; }
.alert-item { padding:8px 12px; border-radius:8px; font-size:10px; display:flex; align-items:center; gap:8px; margin-bottom:5px; }
.alert-item.hot   { background:#fffbeb; border:1px solid #fde68a; color:#92400e; }
.alert-item.snipe { background:#fff7ed; border:1px solid #fed7aa; color:#9a3412; }

/* Cards */
.listings { display:flex; flex-direction:column; gap:10px; }
.skel { height:100px; background:#fff; border-radius:14px; border:1px solid #e8e2d8; margin-bottom:8px; }
.card { display:block; text-decoration:none; background:#fff; border:1px solid #e8e2d8; border-radius:14px; overflow:hidden; transition:all 0.18s; animation:shimIn 0.25s ease both; position:relative; }
.card:hover { background:#f8f4ee; transform:translateY(-2px); box-shadow:0 6px 24px rgba(0,0,0,0.07); }
.card.hc { border:1.5px solid #d97706; box-shadow:0 2px 10px rgba(217,119,6,0.1); }
.card.uc { background:#fffbeb; border:1.5px solid #f59e0b; }
.card.wl { border:1.5px solid #fca5a5; }
.card-inner { display:flex; align-items:stretch; gap:0; }
.card-img { width:90px; min-height:90px; flex-shrink:0; overflow:hidden; background:#f5f0e6; }
.card-img img { width:100%; height:100%; object-fit:cover; display:block; }
.card-img-placeholder { width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:28px; background:linear-gradient(135deg,#f5f0e6,#ede8db); }
.card-content { flex:1; min-width:0; padding:12px 14px; }
.card-top { display:flex; justify-content:space-between; align-items:flex-start; gap:8px; margin-bottom:4px; }
.card-badges { display:flex; gap:4px; flex-wrap:wrap; flex:1; }
.bdg { font-size:9px; font-weight:700; padding:2px 6px; border-radius:4px; white-space:nowrap; }
.bdg.hot     { background:#92400e; color:#fef3c7; letter-spacing:1px; }
.bdg.snipe   { background:#fef2f2; color:#dc2626; animation:pulse 1s infinite; }
.bdg.ending  { background:#fff7ed; color:#ea580c; }
.bdg.nr      { background:#f0fdf4; color:#166534; }
.bdg.estate  { background:#ede9fe; color:#5b21b6; }
.bdg.untested { background:#f1f5f9; color:#475569; }
.bdg.cond-w  { background:#d1fae5; color:#065f46; }
.bdg.cond-s  { background:#fef3c7; color:#92400e; }
.bdg.cond-u  { background:#f1f5f9; color:#475569; }
.watchlist-btn { background:none; border:none; cursor:pointer; font-size:16px; padding:0; line-height:1; flex-shrink:0; opacity:0.4; transition:all 0.15s; }
.watchlist-btn:hover { opacity:1; transform:scale(1.2); }
.watchlist-btn.saved { opacity:1; }
.card-title { font-family:â€˜Loraâ€™,serif; font-size:13px; color:#2c2416; line-height:1.4; margin-bottom:8px; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; }
.card-prices { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.card-price { font-family:monospace; font-size:16px; font-weight:700; color:#1c1410; }
.card-price.a { color:#b45309; }
.card-sep  { font-size:11px; color:#c8bfb0; }
.card-bids { font-size:11px; color:#b8a898; }
.card-time { font-size:11px; margin-left:auto; color:#b8a898; white-space:nowrap; }
.card-time.r { color:#dc2626; font-weight:700; }
.score-bar   { margin-top:7px; display:flex; align-items:center; gap:6px; }
.score-track { flex:1; height:3px; background:#f0ebe0; border-radius:2px; overflow:hidden; }
.score-fill  { height:100%; border-radius:2px; background:linear-gradient(90deg,#d97706,#fbbf24); }
.score-lbl   { font-size:9px; color:#c8bfb0; white-space:nowrap; }

/* Watchlist panel */
.wl-panel { background:#fff; border:1px solid #fca5a5; border-radius:14px; padding:16px; margin-bottom:14px; animation:shimIn 0.2s ease; }
.wl-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.wl-title { font-family:â€˜Loraâ€™,serif; font-size:13px; font-weight:600; color:#dc2626; }
.wl-clear { font-size:10px; color:#c8bfb0; cursor:pointer; border:none; background:none; }
.wl-clear:hover { color:#dc2626; }
.wl-item { display:flex; align-items:center; gap:10px; padding:8px 0; border-bottom:1px solid #fef2f2; }
.wl-item:last-child { border-bottom:none; padding-bottom:0; }
.wl-img { width:40px; height:40px; border-radius:6px; overflow:hidden; background:#f5f0e6; flex-shrink:0; }
.wl-img img { width:100%; height:100%; object-fit:cover; }
.wl-img-ph { width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:18px; background:linear-gradient(135deg,#f5f0e6,#ede8db); border-radius:6px; }
.wl-info { flex:1; min-width:0; }
.wl-name { font-family:â€˜Loraâ€™,serif; font-size:11px; color:#2c2416; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; }
.wl-price { font-size:10px; color:#b8a898; margin-top:2px; }
.wl-remove { background:none; border:none; cursor:pointer; color:#fca5a5; font-size:16px; }
.wl-remove:hover { color:#dc2626; }
.wl-empty { font-size:11px; color:#c8bfb0; text-align:center; padding:8px 0; }
.wl-view { display:inline-block; font-size:9px; color:#b45309; text-decoration:none; margin-top:2px; }

.empty { padding:36px; text-align:center; background:#fff; border-radius:14px; border:1px solid #e8e2d8; }
.empty-icon { font-size:30px; margin-bottom:10px; }
.empty p { font-size:12px; color:#b8a898; }

.footer { margin-top:22px; text-align:center; }
.cta { display:inline-block; padding:12px 30px; background:#d97706; border-radius:12px; color:#fff; font-size:11px; letter-spacing:1.5px; text-decoration:none; transition:all 0.18s; box-shadow:0 4px 16px rgba(217,119,6,0.28); }
.cta:hover { background:#b45309; transform:translateY(-1px); }
.footer-note { margin-top:10px; font-size:9px; color:#c8bfb0; }
</style>

</head>
<body>
<div class="container" style="animation:fadeUp 0.5s ease">

  <div style="margin-bottom:24px">
    <div class="status-bar">
      <span class="dot" id="dot"></span>
      <span class="status-text" id="statusTxt">loadingâ€¦</span>
      <span class="status-time" id="statusTime"></span>
    </div>
    <h1>Vintage Watch<br><span>Deal Hunter</span></h1>
    <p style="margin-top:6px;font-size:11px;color:#b8a898">UK-only auctions Â· deal scoring Â· browser alerts</p>
  </div>

  <div id="apiBanner"></div>
  <div id="notifBanner"></div>
  <div id="alertLog"></div>

  <!-- Watchlist panel -->

  <div id="wlPanel" style="display:none"></div>

  <!-- Search -->

  <div class="search-wrap">
    <input class="search-input" id="searchInput" type="text" placeholder="Search e.g. Seiko 6138, Omega Seamasterâ€¦" oninput="onSearchType()" onkeydown="if(event.key==='Enter')runSearch()">
    <button class="search-clear" id="searchClear" onclick="clearSearch()">âœ•</button>
    <button class="search-go" onclick="runSearch()">Search</button>
  </div>

  <!-- Brands -->

  <div class="section-lbl">BRAND</div>
  <div class="brands">
    <button class="brand on" onclick="setBrand('all')">All</button>
    <button class="brand" onclick="setBrand('seiko')">Seiko</button>
    <button class="brand" onclick="setBrand('citizen')">Citizen</button>
    <button class="brand" onclick="setBrand('orient')">Orient</button>
    <button class="brand" onclick="setBrand('omega')">Omega</button>
    <button class="brand" onclick="setBrand('longines')">Longines</button>
    <button class="brand" onclick="setBrand('tissot')">Tissot</button>
    <button class="brand" onclick="setBrand('bulova')">Bulova</button>
    <button class="brand" onclick="setBrand('casio')">Casio</button>
    <button class="brand" onclick="setBrand('hamilton')">Hamilton</button>
    <button class="brand" onclick="setBrand('rado')">Rado</button>
    <button class="brand" onclick="setBrand('tag heuer')">Tag Heuer</button>
    <button class="brand" onclick="setBrand('zenith')">Zenith</button>
  </div>

  <!-- Condition -->

  <div class="section-lbl">CONDITION</div>
  <div class="condition-row">
    <button class="cond on" onclick="setCond('all')">All conditions</button>
    <button class="cond" onclick="setCond('working')">âœ“ Working</button>
    <button class="cond" onclick="setCond('spares')">ğŸ”§ Spares / Repairs</button>
    <button class="cond" onclick="setCond('unspecified')">? Not specified</button>
  </div>

  <!-- Tabs -->

  <div class="tabs">
    <button class="tab on" onclick="setTab(0,this)">â—ˆ Seiko Vintage</button>
    <button class="tab"    onclick="setTab(1,this)">â—‰ Japanese</button>
    <button class="tab"    onclick="setTab(2,this)">â— All Vintage</button>
  </div>

  <!-- Controls -->

  <div class="controls">
    <button class="pill" id="snipeBtn" onclick="toggleSnipe()">âš¡ Snipe OFF</button>
    <button class="pill" id="priceBtn" onclick="togglePrice()">Â£ Price cap</button>
    <button class="pill" id="wlBtn" onclick="toggleWatchlist()">â™¡ Watchlist</button>
    <select class="sort-sel" id="sortSel" onchange="setSort(this.value)">
      <option value="score">Best deal</option>
      <option value="ending">Ending soonest</option>
      <option value="price_asc">Price â†‘</option>
      <option value="price_desc">Price â†“</option>
    </select>
    <button class="refresh-btn" onclick="doFetch()">â†»</button>
  </div>

  <!-- Price slider -->

  <div class="slider-box" id="sliderBox" style="display:none">
    <div class="slider-hd">
      <span class="slider-lbl">PRICE CEILING</span>
      <span class="slider-val" id="sliderVal">Â£150</span>
    </div>
    <input type="range" id="priceRange" min="5" max="500" step="5" value="150" oninput="slidePrice(this.value)" onchange="doFetch()">
    <div class="slider-limits"><span>Â£5</span><span>Â£500</span></div>
  </div>

  <!-- Countdown -->

  <div class="cdwn">
    <div class="cdwn-hd">
      <span class="cdwn-lbl">AUTO-REFRESH</span>
      <span class="cdwn-t" id="cdwnTime">5:00</span>
    </div>
    <div class="cdwn-track"><div class="cdwn-fill" id="cdwnFill" style="width:100%"></div></div>
  </div>

  <!-- Stats -->

  <div class="stats" id="statsBox" style="display:none">
    <div class="stat"><div class="stat-v" id="sCount" style="color:#1c1410">0</div><div class="stat-l">AUCTIONS</div></div>
    <div class="stat"><div class="stat-v" id="sHot"   style="color:#d97706">0</div><div class="stat-l">HOT BUYS</div></div>
    <div class="stat"><div class="stat-v" id="sLow"   style="color:#16a34a">â€”</div><div class="stat-l">LOWEST BID</div></div>
    <div class="stat"><div class="stat-v" id="sWl"    style="color:#dc2626">0</div><div class="stat-l">WATCHLIST</div></div>
  </div>

  <!-- Listings -->

  <div class="listings" id="listings"></div>

  <!-- Footer -->

  <div class="footer" id="footer" style="display:none">
    <a class="cta" id="ctaBtn" href="#" target="_blank">VIEW ALL ON EBAY.CO.UK â†’</a>
    <p class="footer-note">Live eBay UK data Â· click any listing to view Â· â™¡ to save to watchlist</p>
  </div>

</div>
<script>
const PROXY       = "https://watch-hunter-proxy.vercel.app/api/ebay";
const REFRESH_SEC = 300;
const TABS = [
  { query:"seiko vintage watch" },
  { query:"japan vintage watch automatic" },
  { query:"vintage watch auction" },
];
const VALUE_SIGNALS  = ["no reserve","nr","starting","0.99","estate","collection","lot","bundle","untested","as-is","spares","repair"];
const LUXURY_SIGNALS = ["omega","longines","rolex","zenith","rado","tag heuer","hamilton"];

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let activeTab    = 0;
let activeBrand  = â€œallâ€;
let activeCond   = â€œallâ€;
let customQuery  = â€œâ€;
let snipeOn      = false;
let priceOn      = false;
let maxPrice     = 150;
let sortMode     = â€œscoreâ€;
let showWatchlist = false;
let cdwnSecs     = REFRESH_SEC;
let cdwnTimer    = null;
let auctions     = [];
let rawResults   = [];
let seenHot      = new Set();
let seenSnipe    = new Set();
let alerts       = [];

// â”€â”€ Watchlist (localStorage) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wlLoad() {
try { return JSON.parse(localStorage.getItem(â€œwlâ€) || â€œ[]â€); } catch(e) { return []; }
}
function wlSave(items) {
try { localStorage.setItem(â€œwlâ€, JSON.stringify(items)); } catch(e) {}
}
function wlHas(id)   { return wlLoad().some(x => x.id === id); }
function wlAdd(item) {
const items = wlLoad();
if (!items.some(x => x.id === item.id)) { items.unshift(item); wlSave(items); }
renderWatchlistPanel(); updateWlStat();
}
function wlRemove(id) {
wlSave(wlLoad().filter(x => x.id !== id));
renderWatchlistPanel(); updateWlStat();
// Refresh heart buttons
document.querySelectorAll(`.watchlist-btn[data-id="${id}"]`).forEach(b => {
b.textContent = â€œâ™¡â€; b.classList.remove(â€œsavedâ€);
});
}
function wlToggle(item) {
if (wlHas(item.id)) { wlRemove(item.id); return false; }
else { wlAdd(item); return true; }
}
function updateWlStat() {
document.getElementById(â€œsWlâ€).textContent = wlLoad().length;
}

function renderWatchlistPanel() {
const panel = document.getElementById(â€œwlPanelâ€);
if (!showWatchlist) { panel.style.display = â€œnoneâ€; return; }
const items = wlLoad();
panel.style.display = â€œblockâ€;
if (!items.length) {
panel.innerHTML = `<div class="wl-panel"><div class="wl-header"><span class="wl-title">â™¡ Watchlist</span></div><div class="wl-empty">No saved listings yet â€” tap â™¡ on any card</div></div>`;
return;
}
panel.innerHTML = `<div class="wl-panel"> <div class="wl-header"> <span class="wl-title">â™¡ Watchlist (${items.length})</span> <button class="wl-clear" onclick="wlClearAll()">Clear all</button> </div> ${items.map(item => `
<div class="wl-item">
<div class="wl-img">
${item.image
? `<img src="${item.image}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='<div class=wl-img-ph>âŒš</div>'">`
: `<div class="wl-img-ph">âŒš</div>`}
</div>
<div class="wl-info">
<div class="wl-name">${item.title}</div>
<div class="wl-price">Â£${item.price.toFixed(2)} Â· saved ${item.savedAt||â€â€}</div>
<a class="wl-view" href="${item.url}" target="_blank">View on eBay â†’</a>
</div>
<button class="wl-remove" onclick="wlRemove('${item.id}')">âœ•</button>
</div>
`).join(â€â€)}

  </div>`;
}
function wlClearAll() {
  wlSave([]);
  renderWatchlistPanel();
  updateWlStat();
  document.querySelectorAll(".watchlist-btn").forEach(b => { b.textContent="â™¡"; b.classList.remove("saved"); });
}

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseMins(t) {
if (!t || t === â€œunknownâ€) return 9999;
const d = t.match(/(\d+)d/), h = t.match(/(\d+)h/), m = t.match(/(\d+)m/);
return (d?parseInt(d[1])*1440:0) + (h?parseInt(h[1])*60:0) + (m?parseInt(m[1]):0);
}

function scoreItem(a) {
let s = 0;
const l = (a.title || â€œâ€).toLowerCase();
VALUE_SIGNALS.forEach(sig => { if (l.includes(sig)) s += 2; });
if (a.bids < 2) s += 4; if (a.bids < 5) s += 2;
if (a.price < 20) s += 4; if (a.price < 50) s += 2; if (a.price < 100) s += 1;
LUXURY_SIGNALS.forEach(b => { if (l.includes(b)) s += 3; });
const mins = parseMins(a.timeLeft);
if (mins < 60) s += 2; if (mins < 180) s += 1;
return Math.min(s, 20);
}

function getConditionLabel(c) {
if (!c) return â€œunknownâ€;
const l = c.toLowerCase();
if (l.includes(â€œfor partsâ€) || l.includes(â€œsparesâ€) || l.includes(â€œnot workingâ€) || l.includes(â€œrepairâ€)) return â€œsparesâ€;
if (l.includes(â€œnewâ€) || l.includes(â€œexcellentâ€) || l.includes(â€œvery goodâ€) || l.includes(â€œgoodâ€) || l.includes(â€œusedâ€) || l.includes(â€œpre-ownedâ€) || l.includes(â€œworkingâ€)) return â€œworkingâ€;
return â€œunspecifiedâ€;
}

function getQuery() {
if (customQuery) return customQuery;
if (activeBrand !== â€œallâ€) return `${activeBrand} vintage watch auction`;
return TABS[activeTab].query;
}

// â”€â”€ eBay fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchListings() {
const q = getQuery();
const p = new URLSearchParams({ query: q });
if (priceOn) p.set(â€œmaxPriceâ€, maxPrice);
const res  = await fetch(`${PROXY}?${p}`);
if (!res.ok) throw new Error(`Proxy error ${res.status}`);
const data = await res.json();
if (data.error) throw new Error(data.error);
const items = data.itemSummaries || [];
return items.map(item => {
const price = parseFloat(item.price?.value || item.currentBidPrice?.value || 0);
const bids  = item.bidCount || 0;
let timeLeft = â€œunknownâ€;
if (item.itemEndDate) {
const ms = new Date(item.itemEndDate) - Date.now();
if (ms > 0) {
const tm   = Math.floor(ms / 60000);
const days = Math.floor(tm / 1440);
const hrs  = Math.floor((tm % 1440) / 60);
const mins = tm % 60;
timeLeft = days > 0 ? `${days}d ${hrs}h` : `${hrs}h ${mins}m`;
} else { timeLeft = â€œendedâ€; }
}
const rawCond = item.condition || item.conditionDisplayName || â€œâ€;
return {
id:        item.itemId,
title:     item.title || â€œUnknown itemâ€,
price, bids, timeLeft,
image:     item.image?.imageUrl || item.thumbnailImages?.[0]?.imageUrl || null,
condition: rawCond,
condLabel: getConditionLabel(rawCond),
url:       item.itemWebUrl || `https://www.ebay.co.uk/sch/i.html?_nkw=${encodeURIComponent(q)}&LH_Auction=1&LH_PrefLoc=1`,
};
}).filter(a => a.timeLeft !== â€œendedâ€ && a.price > 0);
}

// â”€â”€ Notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initNotif() {
const el = document.getElementById(â€œnotifBannerâ€);
if (!(â€œNotificationâ€ in window)) return;
if (Notification.permission === â€œgrantedâ€) {
el.innerHTML = `<div class="banner nok">ğŸ”” Alerts active</div>`;
} else if (Notification.permission === â€œdefaultâ€) {
el.innerHTML = `<div class="notif-ask"><span style="font-size:18px">ğŸ””</span><div><h4>Enable deal alerts</h4><p>Get notified for HOT BUYs and auctions ending soon</p></div><button onclick="askNotif()">Enable</button></div>`;
} else {
el.innerHTML = `<div class="banner nno">ğŸ”• Notifications blocked</div>`;
}
}
function askNotif() { Notification.requestPermission().then(() => initNotif()); }
function fireNotif(title, body, tag) {
if (Notification.permission !== â€œgrantedâ€) return;
try { new Notification(title, { body, tag }); } catch(e) {}
}
function checkNotif(list) {
const now = new Date().toLocaleTimeString(â€œen-GBâ€, { hour:â€œ2-digitâ€, minute:â€œ2-digitâ€ });
list.forEach(a => {
const sc = scoreItem(a), mins = parseMins(a.timeLeft);
const short = a.title.split(â€ â€œ).slice(0,5).join(â€ â€œ);
if (sc >= 10 && !seenHot.has(a.id)) {
seenHot.add(a.id);
fireNotif(â€œğŸ”¥ HOT BUY!â€, `${short} â€” Â£${a.price.toFixed(2)}, ${a.timeLeft} left`, `hot-${a.id}`);
alerts.unshift({ type:â€œhotâ€, title:short, price:a.price, time:now });
}
if (mins <= 60 && mins > 0 && !seenSnipe.has(a.id)) {
seenSnipe.add(a.id);
fireNotif(â€œâš¡ Ending soon!â€, `${short} â€” Â£${a.price.toFixed(2)}, ${a.timeLeft} left`, `snipe-${a.id}`);
alerts.unshift({ type:â€œsnipeâ€, title:short, price:a.price, time:now });
}
});
alerts = alerts.slice(0, 8);
if (alerts.length) {
document.getElementById(â€œalertLogâ€).innerHTML =
`<div class="alert-log"><div class="alert-lbl">RECENT ALERTS</div>${ alerts.map(a => `<div class="alert-item ${a.type}">
<span>${a.type===â€œhotâ€?â€œğŸ”¥â€:â€œâš¡â€}</span>
<span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${a.title}</span>
<span style="font-weight:700;margin-left:8px">Â£${a.price.toFixed(2)}</span>
<span style="color:#c8bfb0;margin-left:8px">${a.time}</span>
</div>`).join("") }</div>`;
}
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function condBadge(a) {
if (a.condLabel === â€œsparesâ€)      return `<span class="bdg cond-s">ğŸ”§ Spares/Repairs</span>`;
if (a.condLabel === â€œunspecifiedâ€) return `<span class="bdg cond-u">? Unspecified</span>`;
return â€œâ€; // working is the norm, no badge needed unless HOT etc
}
function keywordBadges(title) {
const l = title.toLowerCase(), out = [];
if (l.includes(â€œno reserveâ€) || /\bnr\b/.test(l)) out.push(`<span class="bdg nr">No Reserve</span>`);
if (l.includes(â€œestateâ€) || l.includes(â€œcollection findâ€)) out.push(`<span class="bdg estate">Estate</span>`);
return out.join(â€â€);
}
function timeBadge(t) {
const m = parseMins(t);
if (m > 120) return â€œâ€;
return m < 60 ? `<span class="bdg snipe">âš¡ SNIPE NOW</span>` : `<span class="bdg ending">â° ENDING SOON</span>`;
}

function cardHTML(a, rank) {
const sc     = scoreItem(a);
const isHot  = sc >= 10;
const mins   = parseMins(a.timeLeft);
const urgent = mins < 60 && mins > 0;
const saved  = wlHas(a.id);
const cls    = [â€œcardâ€, isHot?â€œhcâ€:â€â€, urgent?â€œucâ€:â€â€, saved?â€œwlâ€:â€â€].filter(Boolean).join(â€ â€œ);
const scorePct = Math.min((sc / 20) * 100, 100);

const imgHtml = a.image
? `<img src="${a.image}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='<div class=card-img-placeholder>âŒš</div>'">`
: `<div class="card-img-placeholder">âŒš</div>`;

return `<a class="${cls}" href="${a.url}" target="_blank" style="animation-delay:${rank*0.06}s" id="card-${a.id}"> <div class="card-inner"> <div class="card-img">${imgHtml}</div> <div class="card-content"> <div class="card-top"> <div class="card-badges"> ${isHot ? '<span class="bdg hot">ğŸ”¥ HOT BUY</span>' : ""} ${timeBadge(a.timeLeft)} ${condBadge(a)} ${keywordBadges(a.title)} </div> <button class="watchlist-btn ${saved?"saved":""}" data-id="${a.id}" onclick="event.preventDefault();event.stopPropagation();handleWlToggle('${a.id}')" title="${saved?"Remove from watchlist":"Save to watchlist"}"> ${saved ? "â™¥" : "â™¡"} </button> </div> <div class="card-title">${a.title}</div> <div class="card-prices"> <span class="card-price ${isHot?"a":""}">Â£${a.price.toFixed(2)}</span> <span class="card-sep">Â·</span> <span class="card-bids">${a.bids===0?"no bids":`${a.bids} bid${a.bids!==1?â€œsâ€:â€â€}`}</span> <span class="card-time ${urgent?"r":""}">â± ${a.timeLeft}</span> </div> <div class="score-bar"> <div class="score-track"><div class="score-fill" style="width:${scorePct}%"></div></div> <span class="score-lbl">Deal score ${sc}/20</span> </div> </div> </div> </a>`;
}

function handleWlToggle(id) {
const a = rawResults.find(x => x.id === id);
if (!a) return;
const now = new Date().toLocaleTimeString(â€œen-GBâ€,{hour:â€œ2-digitâ€,minute:â€œ2-digitâ€});
const saved = wlToggle({...a, savedAt: now });
const btn = document.querySelector(`.watchlist-btn[data-id="${id}"]`);
const card = document.getElementById(`card-${id}`);
if (btn) { btn.textContent = saved ? â€œâ™¥â€ : â€œâ™¡â€; btn.classList.toggle(â€œsavedâ€, saved); }
if (card) card.classList.toggle(â€œwlâ€, saved);
renderWatchlistPanel();
updateWlStat();
}

function render() {
const el = document.getElementById(â€œlistingsâ€);
if (!auctions.length) {
el.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ”</div><p>No auctions found â€” try changing filters</p></div>`;
document.getElementById(â€œstatsBoxâ€).style.display = â€œnoneâ€;
document.getElementById(â€œfooterâ€).style.display   = â€œnoneâ€;
return;
}
el.innerHTML = auctions.map((a,i) => cardHTML(a, i+1)).join(â€â€);
const hotCount = auctions.filter(a => scoreItem(a) >= 10).length;
document.getElementById(â€œsCountâ€).textContent = auctions.length;
document.getElementById(â€œsHotâ€).textContent   = hotCount;
document.getElementById(â€œsLowâ€).textContent   = `Â£${Math.min(...auctions.map(a=>a.price)).toFixed(2)}`;
updateWlStat();
document.getElementById(â€œstatsBoxâ€).style.display = â€œflexâ€;
document.getElementById(â€œfooterâ€).style.display   = â€œblockâ€;
document.getElementById(â€œctaBtnâ€).href = `https://www.ebay.co.uk/sch/i.html?_nkw=${encodeURIComponent(getQuery())}&LH_Auction=1&LH_PrefLoc=1${priceOn?`&_udhi=${maxPrice}`:""}`;
}

function applyFiltersAndSort(list) {
let r = Array.from(list);
if (snipeOn) r = r.filter(a => parseMins(a.timeLeft) <= 120);
if (activeCond !== â€œallâ€) r = r.filter(a => a.condLabel === activeCond);
if (sortMode === â€œendingâ€ || snipeOn) r.sort((a,b) => parseMins(a.timeLeft)-parseMins(b.timeLeft));
else if (sortMode === â€œprice_ascâ€)  r.sort((a,b) => a.price-b.price);
else if (sortMode === â€œprice_descâ€) r.sort((a,b) => b.price-a.price);
else r.sort((a,b) => scoreItem(b)-scoreItem(a));
return r.slice(0, 10);
}

// â”€â”€ Main fetch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doFetch(silent=false) {
if (!silent) {
document.getElementById(â€œlistingsâ€).innerHTML = [0,1,2,3].map(i =>
`<div class="skel" style="opacity:${0.65-i*0.1};animation:shimIn 0.3s ease ${i*0.07}s both"></div>`
).join(â€â€);
document.getElementById(â€œstatsBoxâ€).style.display = â€œnoneâ€;
document.getElementById(â€œfooterâ€).style.display   = â€œnoneâ€;
document.getElementById(â€œapiBannerâ€).innerHTML    = â€œâ€;
auctions = []; rawResults = [];
}
const dot = document.getElementById(â€œdotâ€), txt = document.getElementById(â€œstatusTxtâ€);
dot.className = â€œdot loadingâ€; txt.textContent = â€œfetching auctionsâ€¦â€;
try {
rawResults = await fetchListings();
if (!rawResults.length) throw new Error(â€œNo results for this searchâ€);
document.getElementById(â€œapiBannerâ€).innerHTML = `<div class="banner live">âœ“ Live eBay UK Â· Production</div>`;
dot.className = â€œdot liveâ€; txt.textContent = â€œebay uk Â· liveâ€;
} catch(e) {
document.getElementById(â€œapiBannerâ€).innerHTML = `<div class="banner warn">âš  ERROR: ${e.message}<br><span style="font-size:9px;word-break:break-all">${e.stack||"no stack"}</span></div>`;
dot.className = â€œdot warnâ€; txt.textContent = â€œno resultsâ€;
rawResults = [];
}
document.getElementById(â€œstatusTimeâ€).textContent =
new Date().toLocaleTimeString(â€œen-GBâ€, {hour:â€œ2-digitâ€,minute:â€œ2-digitâ€});
auctions = applyFiltersAndSort(rawResults);
render();
checkNotif(auctions);
}

// â”€â”€ Countdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startCountdown() {
if (cdwnTimer) clearInterval(cdwnTimer);
cdwnSecs = REFRESH_SEC;
cdwnTimer = setInterval(() => {
cdwnSecs -= 1;
const pct = (cdwnSecs/REFRESH_SEC)*100, m = Math.floor(cdwnSecs/60), s = cdwnSecs%60;
document.getElementById(â€œcdwnTimeâ€).textContent = `${m}:${s.toString().padStart(2,"0")}`;
document.getElementById(â€œcdwnFillâ€).style.width = `${pct}%`;
if (cdwnSecs <= 0) { cdwnSecs = REFRESH_SEC; doFetch(true); }
}, 1000);
}

// â”€â”€ Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setTab(i, btn) {
activeTab=i; customQuery=â€â€; activeBrand=â€œallâ€;
document.getElementById(â€œsearchInputâ€).value=â€â€;
document.getElementById(â€œsearchClearâ€).className=â€œsearch-clearâ€;
document.querySelectorAll(â€.tabâ€).forEach((t,j) => t.className=â€œtabâ€+(j===i?â€ onâ€:â€â€));
document.querySelectorAll(â€.brandâ€).forEach(b => b.className=â€œbrandâ€+(b.textContent===â€œAllâ€?â€ onâ€:â€â€));
startCountdown(); doFetch();
}

function setBrand(brand) {
activeBrand=brand; customQuery=â€â€;
document.getElementById(â€œsearchInputâ€).value=â€â€;
document.getElementById(â€œsearchClearâ€).className=â€œsearch-clearâ€;
document.querySelectorAll(â€.brandâ€).forEach(b => {
const match = brand===â€œallâ€ ? b.textContent===â€œAllâ€ : b.textContent.toLowerCase()===brand;
b.className = â€œbrandâ€+(match?â€ onâ€:â€â€);
});
startCountdown(); doFetch();
}

function setCond(cond) {
activeCond = cond;
document.querySelectorAll(â€.condâ€).forEach(b => {
const map = {all:â€œAll conditionsâ€, working:â€œâœ“ Workingâ€, spares:â€œğŸ”§ Spares / Repairsâ€, unspecified:â€? Not specifiedâ€};
b.className = â€œcondâ€+(b.textContent.trim()===map[cond]?â€ onâ€:â€â€);
});
auctions = applyFiltersAndSort(rawResults);
render();
}

function onSearchType() {
const v = document.getElementById(â€œsearchInputâ€).value;
document.getElementById(â€œsearchClearâ€).className = â€œsearch-clearâ€+(v?â€ showâ€:â€â€);
}
function runSearch() {
const v = document.getElementById(â€œsearchInputâ€).value.trim();
if (!v) return;
customQuery=v; activeBrand=â€œallâ€;
document.querySelectorAll(â€.brandâ€).forEach(b => b.className=â€œbrandâ€+(b.textContent===â€œAllâ€?â€ onâ€:â€â€));
startCountdown(); doFetch();
}
function clearSearch() {
customQuery=â€â€;
document.getElementById(â€œsearchInputâ€).value=â€â€;
document.getElementById(â€œsearchClearâ€).className=â€œsearch-clearâ€;
doFetch();
}

function toggleSnipe() {
snipeOn=!snipeOn;
const btn=document.getElementById(â€œsnipeBtnâ€);
btn.className=â€œpillâ€+(snipeOn?â€ onâ€:â€â€);
btn.textContent=`âš¡ Snipe ${snipeOn?"ON":"OFF"}`;
auctions=applyFiltersAndSort(rawResults); render();
}

function togglePrice() {
priceOn=!priceOn;
const btn=document.getElementById(â€œpriceBtnâ€);
btn.className=â€œpillâ€+(priceOn?â€ onâ€:â€â€);
btn.textContent=priceOn?`Â£ â‰¤ Â£${maxPrice}`:â€œÂ£ Price capâ€;
document.getElementById(â€œsliderBoxâ€).style.display=priceOn?â€œblockâ€:â€œnoneâ€;
doFetch();
}

function slidePrice(v) {
maxPrice=parseInt(v);
document.getElementById(â€œsliderValâ€).textContent=`Â£${maxPrice}`;
document.getElementById(â€œpriceBtnâ€).textContent=`Â£ â‰¤ Â£${maxPrice}`;
const pct=((maxPrice-5)/495)*100;
document.getElementById(â€œpriceRangeâ€).style.background=`linear-gradient(90deg,#d97706 ${pct}%,#e8e2d8 ${pct}%)`;
}

function setSort(val) {
sortMode=val;
auctions=applyFiltersAndSort(rawResults); render();
}

function toggleWatchlist() {
showWatchlist=!showWatchlist;
const btn=document.getElementById(â€œwlBtnâ€);
btn.className=â€œpillâ€+(showWatchlist?â€ watchlist-onâ€:â€â€);
btn.textContent=showWatchlist?â€œâ™¥ Watchlistâ€:â€œâ™¡ Watchlistâ€;
renderWatchlistPanel();
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
initNotif();
updateWlStat();
startCountdown();
doFetch();
</script>

</body>
</html>
